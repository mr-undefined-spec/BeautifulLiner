
import os
import sys

sys.path.append(os.path.join(os.path.dirname(__file__), '../../model/primitive'))
from point import Point
from cubic_bezier_curve_control_point import CubicBezierCurveControlPoint
from linear_approximate_curve_control_point import LinearApproximateCurveControlPoint

sys.path.append(os.path.join(os.path.dirname(__file__), '../../model/curve'))
from linear_approximate_curve import LinearApproximateCurve
from curve_set import CurveSet

sys.path.append(os.path.join(os.path.dirname(__file__), '../../model/layer'))
from layer import Layer
from layer_set import LayerSet

sys.path.append(os.path.join(os.path.dirname(__file__), '../../handler'))
from split_handler import SplitHandler

sys.path.append(os.path.join(os.path.dirname(__file__), '../helper'))
import model_mocks
import handler_mocks
from handler_mocks import ArcDirection

import unittest

import numpy as np
import math

class TestSplitHandler(unittest.TestCase):
    def setUp(self):

        curve_1 = handler_mocks.create_mock_linear_approximate_curve_of_arc(100.0,    0.0,   0.0,   0.0,  90.0, 100, ArcDirection.CLOCKWISE)
        curve_2 = handler_mocks.create_mock_linear_approximate_curve_of_arc(100.0,    0.0, 200.0, 180.0, 270.0, 100, ArcDirection.COUNTER_CLOCKWISE)
        curve_3 = handler_mocks.create_mock_linear_approximate_curve_of_arc(100.0, -200.0, 200.0,   0.0,  90.0, 100, ArcDirection.CLOCKWISE)

        the_curve = LinearApproximateCurve()
        for ctrl_p_1 in curve_1:
            the_curve.append(ctrl_p_1)
        #end
        for ctrl_p_2 in curve_2:
            the_curve.append(ctrl_p_2)
        #end
        for ctrl_p_3 in curve_3:
            the_curve.append(ctrl_p_3)
        #end

        curve_set = model_mocks.create_mock_curve_set([the_curve])
        layer = model_mocks.create_mock_layer([curve_set])
        self.layer_set = [layer]
        
        #handler_mocks.create_mock_layer_set_of_arc_as_linear_approximate_curve(100.0, 0.0, 0.0, 0.0, 90.0, 100)

    #end

    def test_split(self):

        the_answer = ["100.000 0.000",
                    "99.988 1.571",
                    "99.951 3.141",
                    "99.889 4.711",
                    "99.803 6.279",
                    "99.692 7.846",
                    "99.556 9.411",
                    "99.396 10.973",
                    "99.211 12.533",
                    "99.002 14.090",
                    "98.769 15.643",
                    "98.511 17.193",
                    "98.229 18.738",
                    "97.922 20.279",
                    "97.592 21.814",
                    "97.237 23.345",
                    "96.858 24.869",
                    "96.456 26.387",
                    "96.029 27.899",
                    "95.579 29.404",
                    "95.106 30.902",
                    "94.609 32.392",
                    "94.088 33.874",
                    "93.544 35.347",
                    "92.978 36.812",
                    "92.388 38.268",
                    "91.775 39.715",
                    "91.140 41.151",
                    "90.483 42.578",
                    "89.803 43.994",
                    "89.101 45.399",
                    "88.377 46.793",
                    "87.631 48.175",
                    "86.863 49.546",
                    "86.074 50.904",
                    "85.264 52.250",
                    "84.433 53.583",
                    "83.581 54.902",
                    "82.708 56.208",
                    "81.815 57.501",
                    "80.902 58.779",
                    "79.968 60.042",
                    "79.016 61.291",
                    "78.043 62.524",
                    "77.051 63.742",
                    "76.041 64.945",
                    "75.011 66.131",
                    "73.963 67.301",
                    "72.897 68.455",
                    "71.813 69.591",
                    "70.711 70.711",
                    "69.591 71.813",
                    "68.455 72.897",
                    "67.301 73.963",
                    "66.131 75.011",
                    "64.945 76.041",
                    "63.742 77.051",
                    "62.524 78.043",
                    "61.291 79.016",
                    "60.042 79.968",
                    "58.779 80.902",
                    "57.501 81.815",
                    "56.208 82.708",
                    "54.902 83.581",
                    "53.583 84.433",
                    "52.250 85.264",
                    "50.904 86.074",
                    "49.546 86.863",
                    "48.175 87.631",
                    "46.793 88.377",
                    "45.399 89.101",
                    "43.994 89.803",
                    "42.578 90.483",
                    "41.151 91.140",
                    "39.715 91.775",
                    "38.268 92.388",
                    "36.812 92.978",
                    "35.347 93.544",
                    "33.874 94.088",
                    "32.392 94.609",
                    "30.902 95.106",
                    "29.404 95.579",
                    "27.899 96.029",
                    "26.387 96.456",
                    "24.869 96.858",
                    "23.345 97.237",
                    "21.814 97.592",
                    "20.279 97.922",
                    "18.738 98.229",
                    "17.193 98.511",
                    "15.643 98.769",
                    "14.090 99.002",
                    "12.533 99.211",
                    "10.973 99.396",
                    "9.411 99.556",
                    "7.846 99.692",
                    "6.279 99.803",
                    "4.711 99.889",
                    "3.141 99.951",
                    "1.571 99.988",
                    "-0.000 100.000",
                    "-1.571 100.012",
                    "-3.141 100.049",
                    "-4.711 100.111",
                    "-6.279 100.197",
                    "-7.846 100.308",
                    "-9.411 100.444",
                    "-10.973 100.604",
                    "-12.533 100.789",
                    "-14.090 100.998",
                    "-15.643 101.231",
                    "-17.193 101.489",
                    "-18.738 101.771",
                    "-20.279 102.078",
                    "-21.814 102.408",
                    "-23.345 102.763",
                    "-24.869 103.142",
                    "-26.387 103.544",
                    "-27.899 103.971",
                    "-29.404 104.421",
                    "-30.902 104.894",
                    "-32.392 105.391",
                    "-33.874 105.912",
                    "-35.347 106.456",
                    "-36.812 107.022",
                    "-38.268 107.612",
                    "-39.715 108.225",
                    "-41.151 108.860",
                    "-42.578 109.517",
                    "-43.994 110.197",
                    "-45.399 110.899",
                    "-46.793 111.623",
                    "-48.175 112.369",
                    "-49.546 113.137",
                    "-50.904 113.926",
                    "-52.250 114.736",
                    "-53.583 115.567",
                    "-54.902 116.419",
                    "-56.208 117.292",
                    "-57.501 118.185",
                    "-58.779 119.098",
                    "-60.042 120.032",
                    "-61.291 120.984",
                    "-62.524 121.957",
                    "-63.742 122.949",
                    "-64.945 123.959",
                    "-66.131 124.989",
                    "-67.301 126.037",
                    "-68.455 127.103",
                    "-69.591 128.187",
                    "-70.711 129.289",
                    "-71.813 130.409",
                    "-72.897 131.545",
                    "-73.963 132.699",
                    "-75.011 133.869",
                    "-76.041 135.055",
                    "-77.051 136.258",
                    "-78.043 137.476",
                    "-79.016 138.709",
                    "-79.968 139.958",
                    "-80.902 141.221",
                    "-81.815 142.499",
                    "-82.708 143.792",
                    "-83.581 145.098",
                    "-84.433 146.417",
                    "-85.264 147.750",
                    "-86.074 149.096",
                    "-86.863 150.454",
                    "-87.631 151.825",
                    "-88.377 153.207",
                    "-89.101 154.601",
                    "-89.803 156.006",
                    "-90.483 157.422",
                    "-91.140 158.849",
                    "-91.775 160.285",
                    "-92.388 161.732",
                    "-92.978 163.188",
                    "-93.544 164.653",
                    "-94.088 166.126",
                    "-94.609 167.608",
                    "-95.106 169.098",
                    "-95.579 170.596",
                    "-96.029 172.101",
                    "-96.456 173.613",
                    "-96.858 175.131",
                    "-97.237 176.655",
                    "-97.592 178.186",
                    "-97.922 179.721",
                    "-98.229 181.262",
                    "-98.511 182.807",
                    "-98.769 184.357",
                    "-99.002 185.910",
                    "-99.211 187.467",
                    "-99.396 189.027",
                    "-99.556 190.589",
                    "-99.692 192.154",
                    "-99.803 193.721",
                    "-99.889 195.289",
                    "-99.951 196.859",
                    "-99.988 198.429",
                    "-100.000 200.000",
                    "-100.012 201.571",
                    "-100.049 203.141",
                    "-100.111 204.711",
                    "-100.197 206.279",
                    "-100.308 207.846",
                    "-100.444 209.411",
                    "-100.604 210.973",
                    "-100.789 212.533",
                    "-100.998 214.090",
                    "-101.231 215.643",
                    "-101.489 217.193",
                    "-101.771 218.738",
                    "-102.078 220.279",
                    "-102.408 221.814",
                    "-102.763 223.345",
                    "-103.142 224.869",
                    "-103.544 226.387",
                    "-103.971 227.899",
                    "-104.421 229.404",
                    "-104.894 230.902",
                    "-105.391 232.392",
                    "-105.912 233.874",
                    "-106.456 235.347",
                    "-107.022 236.812",
                    "-107.612 238.268",
                    "-108.225 239.715",
                    "-108.860 241.151",
                    "-109.517 242.578",
                    "-110.197 243.994",
                    "-110.899 245.399",
                    "-111.623 246.793",
                    "-112.369 248.175",
                    "-113.137 249.546",
                    "-113.926 250.904",
                    "-114.736 252.250",
                    "-115.567 253.583",
                    "-116.419 254.902",
                    "-117.292 256.208",
                    "-118.185 257.501",
                    "-119.098 258.779",
                    "-120.032 260.042",
                    "-120.984 261.291",
                    "-121.957 262.524",
                    "-122.949 263.742",
                    "-123.959 264.945",
                    "-124.989 266.131",
                    "-126.037 267.301",
                    "-127.103 268.455",
                    "-128.187 269.591",
                    "-129.289 270.711",
                    "-130.409 271.813",
                    "-131.545 272.897",
                    "-132.699 273.963",
                    "-133.869 275.011",
                    "-135.055 276.041",
                    "-136.258 277.051",
                    "-137.476 278.043",
                    "-138.709 279.016",
                    "-139.958 279.968",
                    "-141.221 280.902",
                    "-142.499 281.815",
                    "-143.792 282.708",
                    "-145.098 283.581",
                    "-146.417 284.433",
                    "-147.750 285.264",
                    "-149.096 286.074",
                    "-150.454 286.863",
                    "-151.825 287.631",
                    "-153.207 288.377",
                    "-154.601 289.101",
                    "-156.006 289.803",
                    "-157.422 290.483",
                    "-158.849 291.140",
                    "-160.285 291.775",
                    "-161.732 292.388",
                    "-163.188 292.978",
                    "-164.653 293.544",
                    "-166.126 294.088",
                    "-167.608 294.609",
                    "-169.098 295.106",
                    "-170.596 295.579",
                    "-172.101 296.029",
                    "-173.613 296.456",
                    "-175.131 296.858",
                    "-176.655 297.237",
                    "-178.186 297.592",
                    "-179.721 297.922",
                    "-181.262 298.229",
                    "-182.807 298.511",
                    "-184.357 298.769",
                    "-185.910 299.002",
                    "-187.467 299.211",
                    "-189.027 299.396",
                    "-190.589 299.556",
                    "-192.154 299.692",
                    "-193.721 299.803",
                    "-195.289 299.889",
                    "-196.859 299.951"]

        the_answer_index = 0

        split_handler = SplitHandler()

        split_layer_set = split_handler.process(self.layer_set)
        for layer in split_layer_set:
            for curve_set in layer:
                #print("[")
                for curve in curve_set:
                    #print(curve)
                    #print("[")
                    for ctrl_p in curve:
                        #print('"' + str(ctrl_p.start) + '",')
                        self.assertEqual(str(ctrl_p.start), the_answer[the_answer_index])
                        the_answer_index += 1
                    #end
                    #print("],")
                #end
                #print("]")
            #end
        #end
    #end


#end

if __name__ == '__main__':
    unittest.main()
#end

